{% extends "layout.html" %}
{% block content %}
{% if not access and topic.private %}
<p class="notice">You do not have permission to view this private topic.</p>
{% else %}
{% if not topic.visible %}
<p class="notice">This topic has been removed.</p>
{% else %}
<div class="list">
    <ul>
        <li class="list-header">
            <h1>{{ topic.title }}</h1>
        </li>
        {% for post in posts %}
        {% if post.user_id == session.user_id or session.is_admin %}
        <form action="/topic/delete_post" method="POST">
            <a href="/post/{{ post.id }}">
                <li>{{ post.title }}<input class="delete-item" type="submit" value="Delete"></li>
            </a>
            <input name="csrf_token" type="hidden" value="{{ session.csrf_token }}">
            <input name="post_id" type="hidden" value="{{ post.id }}">
            <input name="topic_id" type="hidden" value="{{ topic.id }}">
        </form>
        {% else %}
        <a href="/post/{{ post.id }}">
            <li>{{ post.title }}</li>
        </a>
        {% endif %}
        {% endfor %}
    </ul>
</div>
{% if session.user_id %}
<form class="form" action="/topic/{{ topic.id }}" method="POST">
    <p><b>Create a new post</b></p>
    <input name="title" placeholder="Title" type="text">
    <textarea class="comment-box" name="content" placeholder="Message" style="margin-top: 20px"></textarea>
    <button class="button">Create</button>
    <input name="csrf_token" type="hidden" value="{{ session.csrf_token }}">
</form>
{% else %}
<p class="notice">You must be logged in to create a new post.</p>
{% endif %}
{% if session.is_admin and topic.private %}
<form class="form" action="/topic/add_user" method="POST">
    <p><b>Add a new user</b></p>
    <input type="text" name="username" placeholder="Username">
    <button class="button">Add</button>
    <input name="csrf_token" type="hidden" value="{{ session.csrf_token }}">
    <input name="topic_id" type="hidden" value="{{ topic.id }}">
</form>
{% endif %}
{% endif %}
{% endif %}
<button class="button" onclick="location.href='/'">Back to front page</button>
{% endblock %}