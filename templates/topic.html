{% extends "layout.html" %}
{% block content %}
{% if not access and topic.private %}
<p class="notice">Ei oikeutta nähdä sivua</p>
{% else %}
{% if not topic.visible %}
<p class="notice">Tämä keskustelualue on poistettu</p>
{% else %}
<div class="list">
    <ul>
        <li class="list-header">
            <h1>{{ topic.title }}</h1>
        </li>
        {% for post in posts %}
        {% if post.user_id == session.user_id or session.is_admin %}
        <form action="/topic/delete_post" method="POST">
            <a href="/post/{{ post.id }}">
                <li>{{ post.title }}<input class="delete-item" type="submit" value="Poista"></li>
            </a>
            <input name="csrf_token" type="hidden" value="{{ session.csrf_token }}">
            <input name="post_id" type="hidden" value="{{ post.id }}">
            <input name="topic_id" type="hidden" value="{{ topic.id }}">
        </form>
        {% else %}
        <a href="/post/{{ post.id }}">
            <li>{{ post.title }}</li>
        </a>
        {% endif %}
        {% endfor %}
    </ul>
</div>
{% if session.user_id %}
<form class="form" action="/topic/{{ topic.id }}" method="POST">
    <p><b>Luo uusi keskustelu</b></p>
    <input name="title" placeholder="Aihe" type="text">
    <textarea class="comment-box" name="content" placeholder="Viesti" style="margin-top: 20px"></textarea>
    <button class="button">Luo</button>
    <input name="csrf_token" type="hidden" value="{{ session.csrf_token }}">
</form>
{% else %}
<p class="notice">Sinun täytyy olla kirjautunut sisään luodaksesi uuden keskustelun</p>
{% endif %}
{% if session.is_admin and topic.private %}
<form class="form" action="/topic/add_user" method="POST">
    <p><b>Lisää uusi jäsen</b></p>
    <input type="text" name="username" placeholder="Käyttäjänimi">
    <button class="button">Lisää</button>
    <input name="csrf_token" type="hidden" value="{{ session.csrf_token }}">
    <input name="topic_id" type="hidden" value="{{ topic.id }}">
</form>
{% endif %}
{% endif %}
{% endif %}
<button class="button" onclick="location.href='/'">Palaa takaisin</button>
{% endblock %}